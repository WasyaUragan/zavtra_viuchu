#!/bin/bash

source color.sh
source print_slow_ds.sh

# –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–æ–æ–±—à–µ–Ω–∏—è
Message() {
    echo -e "${BOLD}========================================${NC}"
    Print_slow "$1" 0.03
    echo -e "${BOLD}========================================${NC}"
    sleep 2
}

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ (–æ—Ç 1 –¥–æ 100)
Randomizer() {
    declare -g chislo=$((1 + $RANDOM % 100))
}

Message "–ó–∞–≥–∞–¥—ã–≤–∞—é —á–∏—Å–ª–æ –æ—Ç ${GREEN}1${NC} –¥–æ ${GREEN}100${NC} –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ"
Randomizer
echo "DEBUG: –û—Ç–≤–µ—Ç - $chislo"

declare -A spisok_otvetov=()
declare -i score=0
declare -i bet=1000
declare -i round=0
declare -i counter=6

# –ï—Å–ª–∏ –≤ –∏–≥—Ä–µ 6 —Ä–∞—É–Ω–¥–æ–≤
Counter() {
    case $counter in
        1)
            Message "–£ –í–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å ${GREEN}$counter${NC} –ø–æ–ø—ã—Ç–∫–∞"
            ;;
        2|3|4)
            Message "–£ –í–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å ${GREEN}$counter${NC} –ø–æ–ø—ã—Ç–∫–∏"
            ;;
        *)
            Message "–£ –í–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å ${GREEN}$counter${NC} –ø–æ–ø—ã—Ç–æ–∫"
            ;;
    esac
}

# –î–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å '#', –∞ –Ω–µ heredoc. –¢—É—Ç –¥–ª—è –¥–µ–º–æ—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π bash.
<< 'COMMENT' 
    –ò—Å–ø–æ–ª—å–∑—É—é read –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–º –≤—ã–±–æ—Ä–µ (Y/N).
    –ü—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é select.
COMMENT

# –ò–≥—Ä–∞–µ–º / –ù–µ –∏–≥—Ä–∞–µ–º
Choice() {
    while true; do
        local vopros
        if (( round == 0 )); then    
            vopros="–°–ø–æ—Ä–∏–º –Ω–∞ ${GREEN}$bet${NC} –¥–µ—Ä–µ–≤—è–Ω–Ω—ã—Ö, —á—Ç–æ –Ω–µ –æ—Ç–≥–∞–¥–∞–µ—Ç–µ? ${RED}(y/n)${NC}: "
        else
            vopros="–°–ø–æ—Ä–∏–º, —á—Ç–æ –Ω–µ –æ—Ç–≥–∞–¥–∞–µ—Ç–µ? ${RED}(y/n)${NC}: "
        fi

        # –í—ã–≤–æ–¥–∏–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∫–∞–∫ –±–µ–≥—É—â—É—é —Å—Ç—Ä–æ–∫—É
        Print_slow "$vopros" 0.03 true  # true - –±–µ–∑ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏

        read -r yn    
        case "$yn" in
            y|Y|[Yy][Ee][Ss])
                Message "–£ –í–∞—Å –µ—Å—Ç—å ${GREEN}$counter${NC} –ø–æ–ø—ã—Ç–æ–∫."
                break
                ;;
            n|N|[Nn][Oo])
                if (( round > 0 )); then
                    Message "ü§ù –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å: ${GREEN}$score${NC} –¥–µ—Ä–µ–≤—è–Ω–Ω—ã—Ö ü§ù"
                else
                    Message "${RED}ü§¨ –ù–µ –æ—á–µ–Ω—å-—Ç–æ –∏ —Ö–æ—Ç–µ–ª–æ—Å—å!${NC} ü§¨"
                fi
                exit
                ;;
            *)
                Message "${YELLOW}–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!${NC}"
                ;;
        esac
    done
}

# Choice() {
# select yn in "–î–∞" "–ù–µ—Ç"; do
#     case $yn in
#         ...    
#     esac 
# done
# }

Choice

# –ü–æ–ø–∞–¥–∞—é —Å—é–¥–∞ –ø–æ—Å–ª–µ –≤—ã–∏–≥—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞
Revansh() {
    while true; do
        local vopros1="–ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ –æ—Ç—ã–≥—Ä–∞—Ç—å—Å—è! ${RED}(y/n)${NC}: "
        Print_slow "$vopros1" 0.03 true

        read -r ehala
        case "$ehala" in
            y|Y|[Yy][Ee][Ss])
                sleep 2
                Message "üòà –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º! üòà"
                ((score+=$bet))
                # Message "DEBUG: –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è $score"
                Go_next_round
                break
                ;;
            n|N|[Nn][Oo])
                ((score+=$bet))
                Message "–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å: ${GREEN}$score${NC} –¥–µ—Ä–µ–≤—è–Ω–Ω—ã—Ö"
                exit
                ;;
            *)
                echo -e "${YELLOW}–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!${NC}"
                ;;
        esac
    done    
}

# –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.
Game() {
    for ((i = 6; i > 0; i--))
    do
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–ª–∞
        while true; do
            
            local vvod="–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç ${GREEN}1${NC} –¥–æ ${GREEN}100${NC}: "
            Print_slow "$vvod" 0.03 true
            # –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
            read -r otvet
            if ! [[ "$otvet" =~ ^[0-9]+$ ]]; then
                Message "${YELLOW}–û—à–∏–±–∫–∞! –û–∂–∏–¥–∞–µ–º—ã–π –≤–≤–æ–¥ - —á–∏—Å–ª–æ.${NC}"
                continue
            fi
            
            # –û—Ç–≤–µ—Ç - —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100
            if ((otvet < 1 || otvet > 100)); then
                Message "${YELLOW}–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç${NC} ${GREEN}1${NC} –¥–æ ${GREEN}100${NC}!"
                continue
            fi
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
            if [[ -v spisok_otvetov[$otvet] ]]; then
                Message "${YELLOW}–í—ã —É–∂–µ –Ω–∞–∑—ã–≤–∞–ª–∏${NC} ${GREEN}$otvet${NC}! ${YELLOW}–ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –¥—Ä—É–≥—É—é –≤–µ—Ä—Å–∏—é!${NC}"
                continue
            else
                spisok_otvetov["$otvet"]=1
            fi

            break
        done

    ((counter--))  
    
    # –ë–æ–ª—å—à–µ/–ú–µ–Ω—å—à–µ
    if (( otvet > chislo )); then
        Message "${YELLOW}üîª –í—ã –Ω–µ —É–≥–∞–¥–∞–ª–∏. –ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ - –º–µ–Ω—å—à–µ. üîª${NC}"
        Counter
    elif (( otvet < chislo )); then
        Message "${YELLOW}üî∫ –í—ã –Ω–µ —É–≥–∞–¥–∞–ª–∏. –ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ - –±–æ–ª—å—à–µ. üî∫${NC}"
        Counter
    elif (( otvet == chislo )); then
        Message "${GREEN}üí∞ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –£–¥–∞—á–∞ –Ω–∞ –í–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ! üí∞${NC}"
        Revansh
    fi
    done
}

Go_next_round() {
    spisok_otvetov=()
    counter=6
    sleep 1
    bet=$((bet*2))
    Message "–ú–æ—è —Å—Ç–∞–≤–∫–∞ - ${GREEN}$bet${NC} –¥–µ—Ä–µ–≤—è–Ω–Ω—ã—Ö"
    Randomizer
    echo "DEBUG: –û—Ç–≤–µ—Ç - $chislo"
    Game
}

Game

# –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞, –æ—Ç–≤–µ—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
# Message "–°–ø–∏—Å–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤: ${spisok_otvetov[*]}"
# –ï—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤ –∫—Ä–∏—Ç–∏—á–µ–Ω, –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–π –º–∞—Å—Å–∏–≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ.

# –ü–æ–ø–∞–¥–∞—é —Å—é–¥–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –≤ —Ä–∞—É–Ω–¥–µ
while true; do
    Message "${RED}–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!${NC}"
    ((score -= $bet))
    # Message "DEBUG: –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è $score"
    sleep 1
    Message "üëÄ –°—ã–≥—Ä–∞–µ–º –µ—â–µ —Ä–∞–∑? üëÄ"
    ((round++))
    Choice
    Go_next_round
done 

# –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –≤–≤–æ–¥–µ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–∫–æ—Å –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±–∑–µ–Ω–∏–π, —á—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ. –ø—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç.
# –æ—Ñ–æ—Ä–º–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å —Ü–≤–µ—Ç–∞–º–∏ –∏ —ç–º–æ–¥–∑–∏

# –ø–æ–¥—É–º–∞—Ç—å –Ω–∞–¥ –≥—Ä–∞—Ñ–∏–∫–æ–π